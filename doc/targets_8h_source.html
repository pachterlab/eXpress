<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>eXpress: src/targets.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_small.png"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">eXpress&#160;<span id="projectnumber">“1.5”</span></div>
   <div id="projectbrief"><a href=http://bio.math.berkeley.edu/eXpress>http://bio.math.berkeley.edu/eXpress</a></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('targets_8h.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>src/targets.h</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00009"></a>00009 <span class="preprocessor">#ifndef TRANSCRIPTS_H</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span><span class="preprocessor">#define TRANSCRIPTS_H</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;boost/scoped_ptr.hpp&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;boost/shared_ptr.hpp&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;boost/thread.hpp&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;boost/unordered_map.hpp&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;main.h&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;bundles.h&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;sequence.h&quot;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="keyword">class </span><a class="code" href="class_length_distribution.html" title="lengthdistribution.h express">LengthDistribution</a>;
<a name="l00026"></a>00026 <span class="keyword">class </span><a class="code" href="class_frag_hit.html" title="The FragHit struct stores the information for a single fragment alignment.">FragHit</a>;
<a name="l00027"></a>00027 <span class="keyword">class </span><a class="code" href="class_bias_boss.html" title="The BiasBoss class keeps track of sequence-specific and positional bias.">BiasBoss</a>;
<a name="l00028"></a>00028 <span class="keyword">class </span><a class="code" href="class_mismatch_table.html" title="The MismatchTable class is used to store and update mismatch and indel (error) parameters using a fir...">MismatchTable</a>;
<a name="l00029"></a>00029 <span class="keyword">class </span><a class="code" href="class_librarian.html" title="The Librarian class keeps track of the different library objects for a run.">Librarian</a>;
<a name="l00030"></a>00030 <span class="keyword">class </span><a class="code" href="class_haplotype_handler.html" title="The HaplotypeHandler class keeps track of sets of transcripts from different chromosomes.">HaplotypeHandler</a>;
<a name="l00031"></a>00031 <span class="keyword">class </span><a class="code" href="class_target_table.html" title="The TargetTable class is used to keep track of the Target objects for a run.">TargetTable</a>;
<a name="l00032"></a>00032 
<a name="l00040"></a><a class="code" href="struct_round_params.html">00040</a> <span class="keyword">struct </span><a class="code" href="struct_round_params.html" title="The RoundParams struct stores the target parameters unique to a given round (iteration) of EM...">RoundParams</a> {
<a name="l00045"></a><a class="code" href="struct_round_params.html#aae99a35085aaf19e5bba8752a1f6ea15">00045</a>   <span class="keywordtype">double</span> <a class="code" href="struct_round_params.html#aae99a35085aaf19e5bba8752a1f6ea15" title="A public double that stores the (logged) assigned mass based on observed fragment mapping probabiliti...">mass</a>;
<a name="l00050"></a><a class="code" href="struct_round_params.html#a0de3e04575fbe524b8bfffe718893e06">00050</a>   <span class="keywordtype">double</span> <a class="code" href="struct_round_params.html#a0de3e04575fbe524b8bfffe718893e06" title="A public double that stores the (logged) assigned ambiguous mass based on observed fragment mapping p...">ambig_mass</a>;
<a name="l00055"></a><a class="code" href="struct_round_params.html#a795e3d44ddbbdac069eb45be75e67cff">00055</a>   <span class="keywordtype">double</span> <a class="code" href="struct_round_params.html#a795e3d44ddbbdac069eb45be75e67cff" title="A public double that stores the (logged) total mass of ambiguous fragments mapping to the target...">tot_ambig_mass</a>;
<a name="l00059"></a><a class="code" href="struct_round_params.html#ab27a593c0127a31bbdb04c6561e57a20">00059</a>   <span class="keywordtype">double</span> <a class="code" href="struct_round_params.html#ab27a593c0127a31bbdb04c6561e57a20" title="A public double that stores the (logged) variance due to uncertainty on p.">mass_var</a>;
<a name="l00064"></a><a class="code" href="struct_round_params.html#aaec1a95300ef09f4ad29b90557fc83b9">00064</a>   <span class="keywordtype">double</span> <a class="code" href="struct_round_params.html#aaec1a95300ef09f4ad29b90557fc83b9" title="A public double that stores the (logged) weighted sum of the variance on the assignments.">var_sum</a>;
<a name="l00065"></a>00065   <span class="comment">/***</span>
<a name="l00066"></a>00066 <span class="comment">   * A shared pointer to the target&#39;s HaplotypeHandler.  Null if target has no</span>
<a name="l00067"></a>00067 <span class="comment">   * haplotype partner.</span>
<a name="l00068"></a>00068 <span class="comment">   **/</span>
<a name="l00069"></a>00069   boost::shared_ptr&lt;HaplotypeHandler&gt; haplotype;
<a name="l00073"></a><a class="code" href="struct_round_params.html#a7ad02b4b4baf47ceb959ea84c9b46ecd">00073</a>   <a class="code" href="struct_round_params.html#a7ad02b4b4baf47ceb959ea84c9b46ecd" title="RoundParams constructor sets initial values for parameters.">RoundParams</a>() : <a class="code" href="struct_round_params.html#aae99a35085aaf19e5bba8752a1f6ea15" title="A public double that stores the (logged) assigned mass based on observed fragment mapping probabiliti...">mass</a>(LOG_0), <a class="code" href="struct_round_params.html#a0de3e04575fbe524b8bfffe718893e06" title="A public double that stores the (logged) assigned ambiguous mass based on observed fragment mapping p...">ambig_mass</a>(LOG_0), <a class="code" href="struct_round_params.html#a795e3d44ddbbdac069eb45be75e67cff" title="A public double that stores the (logged) total mass of ambiguous fragments mapping to the target...">tot_ambig_mass</a>(LOG_0),
<a name="l00074"></a>00074                   <a class="code" href="struct_round_params.html#ab27a593c0127a31bbdb04c6561e57a20" title="A public double that stores the (logged) variance due to uncertainty on p.">mass_var</a>(LOG_0), <a class="code" href="struct_round_params.html#aaec1a95300ef09f4ad29b90557fc83b9" title="A public double that stores the (logged) weighted sum of the variance on the assignments.">var_sum</a>(LOG_0) {}
<a name="l00075"></a>00075 };
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="keyword">typedef</span> <span class="keywordtype">size_t</span> TargID;
<a name="l00078"></a>00078 
<a name="l00090"></a><a class="code" href="class_target.html">00090</a> <span class="keyword">class </span><a class="code" href="class_target.html" title="The Target class is used to store objects for the targets being mapped to.">Target</a> {
<a name="l00091"></a>00091   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="class_haplotype_handler.html" title="The HaplotypeHandler class keeps track of sets of transcripts from different chromosomes.">HaplotypeHandler</a>;
<a name="l00092"></a>00092   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="class_target_table.html" title="The TargetTable class is used to keep track of the Target objects for a run.">TargetTable</a>;
<a name="l00097"></a>00097   <span class="keyword">const</span> <a class="code" href="class_librarian.html" title="The Librarian class keeps track of the different library objects for a run.">Librarian</a>* _libs;
<a name="l00101"></a>00101   TargID _id;
<a name="l00105"></a>00105   std::string _name;
<a name="l00109"></a>00109   <a class="code" href="class_sequence_fwd.html" title="The SequenceFwd class implements the Sequence abstract class for storing the forward sequence...">SequenceFwd</a> _seq_f;
<a name="l00113"></a>00113   <a class="code" href="class_sequence_rev.html" title="The SequenceRev class implements the Sequence abstract class for accessing the reverse sequence...">SequenceRev</a> _seq_r;
<a name="l00117"></a>00117   <span class="keywordtype">double</span> _alpha;
<a name="l00122"></a>00122   <a class="code" href="struct_round_params.html" title="The RoundParams struct stores the target parameters unique to a given round (iteration) of EM...">RoundParams</a> _curr_params;
<a name="l00127"></a>00127   <a class="code" href="struct_round_params.html" title="The RoundParams struct stores the target parameters unique to a given round (iteration) of EM...">RoundParams</a> _last_params;
<a name="l00132"></a>00132   <a class="code" href="struct_round_params.html" title="The RoundParams struct stores the target parameters unique to a given round (iteration) of EM...">RoundParams</a>* _ret_params;
<a name="l00137"></a>00137   <span class="keywordtype">size_t</span> _uniq_counts;
<a name="l00143"></a>00143   <span class="keywordtype">size_t</span> _tot_counts;
<a name="l00147"></a>00147   <span class="keywordtype">double</span> _init_pseudo_mass;
<a name="l00151"></a>00151   <a class="code" href="class_bundle.html" title="The Bundle class keeps track of a group of targets that have shared ambiguous (multi-mapped) reads...">Bundle</a>* _bundle;
<a name="l00156"></a>00156   <span class="keyword">mutable</span> boost::mutex _mutex;
<a name="l00161"></a>00161   boost::scoped_ptr&lt;std::vector&lt;float&gt; &gt; _start_bias;
<a name="l00165"></a>00165   boost::scoped_ptr&lt;std::vector&lt;float&gt; &gt; _start_bias_buffer;
<a name="l00170"></a>00170   boost::scoped_ptr&lt;std::vector&lt;float&gt; &gt; _end_bias;
<a name="l00174"></a>00174   boost::scoped_ptr&lt;std::vector&lt;float&gt; &gt; _end_bias_buffer;
<a name="l00179"></a>00179   <span class="keywordtype">double</span> _avg_bias;
<a name="l00183"></a>00183   <span class="keywordtype">double</span> _avg_bias_buffer;
<a name="l00188"></a>00188   <span class="keywordtype">double</span> _cached_eff_len;
<a name="l00192"></a>00192   <span class="keywordtype">double</span> _cached_eff_len_buffer;
<a name="l00198"></a>00198   <span class="keywordtype">bool</span> _solvable;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="keyword">public</span>:
<a name="l00217"></a>00217   <a class="code" href="class_target.html#a398221f0580295e21d69992af0229e1a" title="Target Constructor.">Target</a>(TargID <span class="keywordtype">id</span>, <span class="keyword">const</span> std::string&amp; <a class="code" href="class_target.html#a8534c03431aa63d07defca5f90f0fbad" title="An accessor for the target name.">name</a>, <span class="keyword">const</span> std::string&amp; <a class="code" href="class_target.html#a8fec0cb27d4ae3d7b31059250428efb4" title="An accessor for the the target&amp;#39;s Sequence (const).">seq</a>,
<a name="l00218"></a>00218          <span class="keywordtype">bool</span> prob_seq, <span class="keywordtype">double</span> <a class="code" href="class_target.html#a6856a9496480686c9f62daa73885c274" title="Mutator for the alpha (prior count) parameter of the target.">alpha</a>, <span class="keyword">const</span> <a class="code" href="class_librarian.html" title="The Librarian class keeps track of the different library objects for a run.">Librarian</a>* libs,
<a name="l00219"></a>00219          <span class="keyword">const</span> <a class="code" href="class_bias_boss.html" title="The BiasBoss class keeps track of sequence-specific and positional bias.">BiasBoss</a>* known_bias_boss, <span class="keyword">const</span> <a class="code" href="class_length_distribution.html" title="lengthdistribution.h express">LengthDistribution</a>* known_fld);
<a name="l00224"></a><a class="code" href="class_target.html#a094ef13a70dbbd5196ac158e896f7f5f">00224</a>   <span class="keywordtype">void</span> <a class="code" href="class_target.html#a094ef13a70dbbd5196ac158e896f7f5f" title="A member function that locks the target mutex to provide thread safety.">lock</a>()<span class="keyword"> const </span>{ _mutex.lock(); }
<a name="l00228"></a><a class="code" href="class_target.html#aca6c17dee4d1f1c7d7c6a0fe60885046">00228</a>   <span class="keywordtype">void</span> <a class="code" href="class_target.html#aca6c17dee4d1f1c7d7c6a0fe60885046" title="A member function that unlocks the target mutex.">unlock</a>()<span class="keyword"> const </span>{ _mutex.unlock(); }
<a name="l00233"></a><a class="code" href="class_target.html#a8534c03431aa63d07defca5f90f0fbad">00233</a>   <span class="keyword">const</span> std::string&amp; <a class="code" href="class_target.html#a8534c03431aa63d07defca5f90f0fbad" title="An accessor for the target name.">name</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _name; }
<a name="l00238"></a><a class="code" href="class_target.html#a321594c9b0d800af152d40b593bdddc3">00238</a>   TargID <a class="code" href="class_target.html#a321594c9b0d800af152d40b593bdddc3" title="An accessor for the target id.">id</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _id; }
<a name="l00244"></a><a class="code" href="class_target.html#a8fec0cb27d4ae3d7b31059250428efb4">00244</a>   <span class="keyword">const</span> <a class="code" href="class_sequence.html" title="The Sequence class is an abstract class whose implmentations are used to store and access encoded nuc...">Sequence</a>&amp; <a class="code" href="class_target.html#a8fec0cb27d4ae3d7b31059250428efb4" title="An accessor for the the target&amp;#39;s Sequence (const).">seq</a>(<span class="keywordtype">bool</span> rev=<span class="keyword">false</span>)<span class="keyword"> const </span>{
<a name="l00245"></a>00245     <span class="keywordflow">if</span> (rev) {
<a name="l00246"></a>00246       <span class="keywordflow">return</span> _seq_r;
<a name="l00247"></a>00247     }
<a name="l00248"></a>00248     <span class="keywordflow">return</span> _seq_f;
<a name="l00249"></a>00249   }
<a name="l00255"></a><a class="code" href="class_target.html#ad10790d1aeb008356701326c01a6e05b">00255</a>   <a class="code" href="class_sequence.html" title="The Sequence class is an abstract class whose implmentations are used to store and access encoded nuc...">Sequence</a>&amp; <a class="code" href="class_target.html#ad10790d1aeb008356701326c01a6e05b" title="An accessor for the the target&amp;#39;s Sequence (non-const).">seq</a>(<span class="keywordtype">bool</span> rev) {
<a name="l00256"></a>00256     <span class="keywordflow">if</span> (rev) {
<a name="l00257"></a>00257       <span class="keywordflow">return</span> _seq_r;
<a name="l00258"></a>00258     }
<a name="l00259"></a>00259     <span class="keywordflow">return</span> _seq_f;
<a name="l00260"></a>00260   }
<a name="l00265"></a><a class="code" href="class_target.html#a694c2b68413eeed536a421a478f2a8a5">00265</a>   <span class="keywordtype">void</span> <a class="code" href="class_target.html#a694c2b68413eeed536a421a478f2a8a5" title="Mutator for the HaplotypeHandler of the target.">haplotype</a>(boost::shared_ptr&lt;HaplotypeHandler&gt; hh) {
<a name="l00266"></a>00266     _curr_params.haplotype = hh;
<a name="l00267"></a>00267   }
<a name="l00272"></a><a class="code" href="class_target.html#a6856a9496480686c9f62daa73885c274">00272</a>   <span class="keywordtype">void</span> <a class="code" href="class_target.html#a6856a9496480686c9f62daa73885c274" title="Mutator for the alpha (prior count) parameter of the target.">alpha</a>(<span class="keywordtype">double</span> alpha) { _alpha = log(alpha); }
<a name="l00277"></a><a class="code" href="class_target.html#aaff6b643c19808545062bd1489147c92">00277</a>   <span class="keywordtype">size_t</span> <a class="code" href="class_target.html#aaff6b643c19808545062bd1489147c92" title="An accessor for the length of the target sequence.">length</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _seq_f.<a class="code" href="class_sequence_fwd.html#a0e3371a67a5242e517073d75278ce6f5" title="An accessor for the length of the encoded sequence.">length</a>(); }
<a name="l00283"></a>00283   <span class="keywordtype">double</span> <a class="code" href="class_target.html#a089c04f418a6fa105c73453a4f3250b2" title="An accessor for he current estimated relative abundance of the target.">rho</a>() <span class="keyword">const</span>;
<a name="l00291"></a>00291   <span class="keywordtype">double</span> <a class="code" href="class_target.html#a3f88f9677bd81327e0f011dcfd871878" title="An accessor for the current (logged) probabilistically assigned fragment mass.">mass</a>(<span class="keywordtype">bool</span> with_pseudo=<span class="keyword">true</span>) <span class="keyword">const</span>;
<a name="l00297"></a>00297   <span class="keywordtype">double</span> <a class="code" href="class_target.html#a97c25966ff3e4244d43e787f060f15c2" title="An accessor for the total (logged) variance on mass.">mass_var</a>() <span class="keyword">const</span>;
<a name="l00302"></a><a class="code" href="class_target.html#ac1c359dc7e2860f6bdf9f51d510fe786">00302</a>   <span class="keywordtype">double</span> <a class="code" href="class_target.html#ac1c359dc7e2860f6bdf9f51d510fe786" title="An accessor for the (logged) weighted sum of the variance on assignments.">var_sum</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _ret_params-&gt;<a class="code" href="struct_round_params.html#aaec1a95300ef09f4ad29b90557fc83b9" title="A public double that stores the (logged) weighted sum of the variance on the assignments.">var_sum</a>; }
<a name="l00309"></a><a class="code" href="class_target.html#a456f9e8f3c010898c3827eb0619ce9a1">00309</a>   <span class="keywordtype">double</span> <a class="code" href="class_target.html#a456f9e8f3c010898c3827eb0619ce9a1" title="An accessor for the the (logged) total mass of ambiguous fragments mapping to the target...">tot_ambig_mass</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _ret_params-&gt;<a class="code" href="struct_round_params.html#a795e3d44ddbbdac069eb45be75e67cff" title="A public double that stores the (logged) total mass of ambiguous fragments mapping to the target...">tot_ambig_mass</a>; }
<a name="l00314"></a>00314   <span class="keywordtype">void</span> <a class="code" href="class_target.html#a54c38189e078e975a311b665edec35bb" title="A member function that prepares the target object for the next round of batch EM.">round_reset</a>();
<a name="l00320"></a><a class="code" href="class_target.html#a2d36822e22c5dd9dc3fc3f4a713c385f">00320</a>   <span class="keywordtype">size_t</span> <a class="code" href="class_target.html#a2d36822e22c5dd9dc3fc3f4a713c385f" title="An accessor for the current count of fragments mapped to this target either uniquely or ambiguously...">tot_counts</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _tot_counts; }
<a name="l00326"></a><a class="code" href="class_target.html#a79ee214a113b6bc0d07d924bc6744ab4">00326</a>   <span class="keywordtype">size_t</span> <a class="code" href="class_target.html#a79ee214a113b6bc0d07d924bc6744ab4" title="An accessor for the the current count of fragments uniquely mapped to this target.">uniq_counts</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _uniq_counts; }
<a name="l00331"></a><a class="code" href="class_target.html#a6c196c40693d9eea282c2640403e87fb">00331</a>   <a class="code" href="class_bundle.html" title="The Bundle class keeps track of a group of targets that have shared ambiguous (multi-mapped) reads...">Bundle</a>* <a class="code" href="class_target.html#a6c196c40693d9eea282c2640403e87fb" title="An accessor for the pointer to the Bundle this Target is a member of.">bundle</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _bundle; }
<a name="l00336"></a><a class="code" href="class_target.html#a13a610424a55dac60330f229f02af1bb">00336</a>   <span class="keywordtype">void</span> <a class="code" href="class_target.html#a13a610424a55dac60330f229f02af1bb" title="A mutator to set the Bundle this Target is a member of.">bundle</a>(<a class="code" href="class_bundle.html" title="The Bundle class keeps track of a group of targets that have shared ambiguous (multi-mapped) reads...">Bundle</a>* b) { _bundle = b; }
<a name="l00346"></a>00346   <span class="keywordtype">void</span> <a class="code" href="class_target.html#a6da8e95fc1216088cc88375df906932e" title="A member function that increases the expected fragment counts and variance based on the assignment pa...">add_hit</a>(<span class="keyword">const</span> <a class="code" href="class_frag_hit.html" title="The FragHit struct stores the information for a single fragment alignment.">FragHit</a>&amp; h, <span class="keywordtype">double</span> v, <span class="keywordtype">double</span> <a class="code" href="class_target.html#a3f88f9677bd81327e0f011dcfd871878" title="An accessor for the current (logged) probabilistically assigned fragment mass.">mass</a>);
<a name="l00354"></a><a class="code" href="class_target.html#a0c5745b36c50c9f9aa6f3aa1f5ff03f8">00354</a>   <span class="keywordtype">void</span> <a class="code" href="class_target.html#a0c5745b36c50c9f9aa6f3aa1f5ff03f8" title="A member function that increases the count of fragments mapped to this target.">incr_counts</a>(<span class="keywordtype">bool</span> uniq, <span class="keywordtype">size_t</span> incr_amt = 1) {
<a name="l00355"></a>00355     <span class="keywordflow">if</span> (uniq) {
<a name="l00356"></a>00356       _solvable = <span class="keyword">true</span>;
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358     _tot_counts += incr_amt;
<a name="l00359"></a>00359     _uniq_counts += incr_amt * uniq;
<a name="l00360"></a>00360   }
<a name="l00371"></a>00371   <span class="keywordtype">double</span> <a class="code" href="class_target.html#a39d13d74b88b036fdcf13e4c9a5428c1" title="A member function that returns (a value proportional to) the probability of randomly sampling a fragm...">sample_likelihood</a>(<span class="keywordtype">bool</span> with_pseudo,
<a name="l00372"></a>00372                            <span class="keyword">const</span> std::vector&lt;const Target*&gt;* neighbors = NULL)
<a name="l00373"></a>00373   <span class="keyword">const</span>;
<a name="l00379"></a>00379   <span class="keywordtype">double</span> <a class="code" href="class_target.html#a365a19008baff0d6ca64e98c64f7e1ff" title="A member function that returns (a value proportional to) the log likelihood the given fragment has th...">align_likelihood</a>(<span class="keyword">const</span> <a class="code" href="class_frag_hit.html" title="The FragHit struct stores the information for a single fragment alignment.">FragHit</a>&amp; frag) <span class="keyword">const</span>;
<a name="l00390"></a>00390   <span class="keywordtype">double</span> <a class="code" href="class_target.html#a7ebc1d0fdfc673f07b29530721687925" title="A member function that calculates and returns the estimated effective length of the target (logged) u...">est_effective_length</a>(<span class="keyword">const</span> <a class="code" href="class_length_distribution.html" title="lengthdistribution.h express">LengthDistribution</a>* fld = NULL,
<a name="l00391"></a>00391                               <span class="keywordtype">bool</span> with_bias=<span class="keyword">true</span>) <span class="keyword">const</span>;
<a name="l00399"></a>00399   <span class="keywordtype">double</span> <a class="code" href="class_target.html#a5194c34f46873aaacf6f1323f0b51f9d" title="An accessor for the most recently estimated effective length (logged) as calculated by the bias updat...">cached_effective_length</a>(<span class="keywordtype">bool</span> with_bias=<span class="keyword">true</span>) <span class="keyword">const</span>;
<a name="l00409"></a>00409   <span class="keywordtype">void</span> <a class="code" href="class_target.html#a3344ff5403181bca5483ea1bf540fa0a" title="A member function that causes the target bias to be re-calculated by the _bias_table based on curent ...">update_target_bias_buffer</a>(<span class="keyword">const</span> <a class="code" href="class_bias_boss.html" title="The BiasBoss class keeps track of sequence-specific and positional bias.">BiasBoss</a>* bias_table = NULL,
<a name="l00410"></a>00410                                  <span class="keyword">const</span> <a class="code" href="class_length_distribution.html" title="lengthdistribution.h express">LengthDistribution</a>* fld = NULL);
<a name="l00415"></a>00415   <span class="keywordtype">void</span> <a class="code" href="class_target.html#a2fc157a5812c6821e9bdc7e3947f56b1" title="Swaps in the buffered bias parameters for atomic updating.">swap_bias_parameters</a>();
<a name="l00422"></a><a class="code" href="class_target.html#ab529fc4dd59e202505075e93c67f96da">00422</a>   <span class="keywordtype">bool</span> <a class="code" href="class_target.html#ab529fc4dd59e202505075e93c67f96da" title="An accessor for the _solvable flag.">solvable</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _solvable; }
<a name="l00428"></a><a class="code" href="class_target.html#ab166e750ffa9cd5cdc8c74d1c3a3c115">00428</a>   <span class="keywordtype">void</span> <a class="code" href="class_target.html#ab166e750ffa9cd5cdc8c74d1c3a3c115" title="A mutator that sets the _solvable flag.">solvable</a>(<span class="keywordtype">bool</span> s) { _solvable = s; }
<a name="l00429"></a>00429 };
<a name="l00430"></a>00430 
<a name="l00446"></a><a class="code" href="class_haplotype_handler.html">00446</a> <span class="keyword">class </span><a class="code" href="class_haplotype_handler.html" title="The HaplotypeHandler class keeps track of sets of transcripts from different chromosomes.">HaplotypeHandler</a> {
<a name="l00450"></a>00450   std::vector&lt;const Target*&gt; _targets;
<a name="l00455"></a>00455   <a class="code" href="class_frequency_matrix.html">FrequencyMatrix&lt;double&gt;</a> _haplo_taus;
<a name="l00461"></a>00461   std::string _frag_name_buff;
<a name="l00466"></a>00466   std::vector&lt;double&gt; _align_likelihoods_buff;
<a name="l00471"></a>00471   std::vector&lt;double&gt; _masses_buff;
<a name="l00476"></a>00476   <span class="keywordtype">bool</span> _committed;
<a name="l00481"></a>00481   <span class="keywordtype">size_t</span> find_target(<span class="keyword">const</span> <a class="code" href="class_target.html" title="The Target class is used to store objects for the targets being mapped to.">Target</a>* targ);
<a name="l00486"></a>00486   <span class="keywordtype">void</span> commit_buffer();
<a name="l00487"></a>00487  <span class="keyword">public</span>:
<a name="l00492"></a>00492   <a class="code" href="class_haplotype_handler.html#abf42dcdce6b3a81915604e80f8c8dcdc" title="Constructor for the HaplotypeHandler.">HaplotypeHandler</a>(std::vector&lt;Target*&gt; targets, <span class="keywordtype">double</span> alpha);
<a name="l00496"></a>00496   <span class="keywordtype">double</span> <a class="code" href="class_haplotype_handler.html#a833114c816a6a66b33e8c09846c8a9d0" title="Gets the current relative mass of the given target within the set.">get_mass</a>(<span class="keyword">const</span> <a class="code" href="class_target.html" title="The Target class is used to store objects for the targets being mapped to.">Target</a>* targ, <span class="keywordtype">bool</span> with_pseudo);
<a name="l00501"></a>00501   <span class="keywordtype">void</span> <a class="code" href="class_haplotype_handler.html#ab5539aaa487c5ebb693968e42f57cfb5" title="Buffers the mass and likelihood assigned to the given fragment for the given target.">update_mass</a>(<span class="keyword">const</span> <a class="code" href="class_target.html" title="The Target class is used to store objects for the targets being mapped to.">Target</a>* targ, <span class="keyword">const</span> std::string&amp; frag_name,
<a name="l00502"></a>00502                    <span class="keywordtype">double</span> align_likelihood, <span class="keywordtype">double</span> mass);
<a name="l00503"></a>00503 };
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 <span class="keyword">typedef</span> std::vector&lt;Target*&gt; TransMap;
<a name="l00507"></a>00507 <span class="keyword">typedef</span> boost::unordered_map&lt;std::string, size_t&gt; TransIndex;
<a name="l00508"></a>00508 <span class="keyword">typedef</span> boost::unordered_map&lt;size_t, float&gt; CovarMap;
<a name="l00509"></a>00509 <span class="keyword">typedef</span> boost::unordered_map&lt;std::string, double&gt; AlphaMap;
<a name="l00510"></a>00510 <span class="keyword">typedef</span> boost::unordered_set&lt;std::vector&lt;Target*&gt; &gt; HaplotypeSet;
<a name="l00511"></a>00511 
<a name="l00520"></a><a class="code" href="class_target_table.html">00520</a> <span class="keyword">class </span><a class="code" href="class_target_table.html" title="The TargetTable class is used to keep track of the Target objects for a run.">TargetTable</a> {
<a name="l00525"></a>00525   <span class="keyword">const</span> <a class="code" href="class_librarian.html" title="The Librarian class keeps track of the different library objects for a run.">Librarian</a>* _libs;
<a name="l00529"></a>00529   TransMap _targ_map;
<a name="l00533"></a>00533   <a class="code" href="class_bundle_table.html" title="The BundleTable class keeps track of the Bundle objects for a given run.">BundleTable</a> _bundle_table;
<a name="l00539"></a>00539   <a class="code" href="class_covar_table.html" title="The CovarTable is a sparse matrix for storing and updating pairwise covariances between targets...">CovarTable</a> _covar_table;
<a name="l00544"></a>00544   HaplotypeSet _haplotype_groups;
<a name="l00549"></a>00549   <span class="keywordtype">double</span> _total_fpb;
<a name="l00553"></a>00553   <span class="keyword">mutable</span> boost::mutex _fpb_mut;
<a name="l00554"></a>00554 
<a name="l00569"></a>00569   <span class="keywordtype">void</span> add_targ(<span class="keyword">const</span> std::string&amp; name, <span class="keyword">const</span> std::string&amp; seq, <span class="keywordtype">bool</span> prob_seqs,
<a name="l00570"></a>00570                 <span class="keywordtype">bool</span> known_aux_params, <span class="keywordtype">double</span> alpha,
<a name="l00571"></a>00571                 <span class="keyword">const</span> TransIndex&amp; targ_index, <span class="keyword">const</span> TransIndex&amp; targ_lengths);
<a name="l00572"></a>00572 
<a name="l00573"></a>00573 <span class="keyword">public</span>:
<a name="l00592"></a>00592   <a class="code" href="class_target_table.html#aab247da634f0f6f18c714e726868b65a" title="TargetTable Constructor.">TargetTable</a>(std::string targ_fasta_file, std::string haplotype_file,
<a name="l00593"></a>00593               <span class="keywordtype">bool</span> prob_seqs, <span class="keywordtype">bool</span> known_aux_params, <span class="keywordtype">double</span> alpha,
<a name="l00594"></a>00594               <span class="keyword">const</span> AlphaMap* alpha_map, <span class="keyword">const</span> <a class="code" href="class_librarian.html" title="The Librarian class keeps track of the different library objects for a run.">Librarian</a>* libs);
<a name="l00598"></a>00598   <a class="code" href="class_target_table.html#ab2790987f9eaf1ae19389e7d1837192e" title="TargetTable Destructor.">~TargetTable</a>();
<a name="l00604"></a>00604   <a class="code" href="class_target.html" title="The Target class is used to store objects for the targets being mapped to.">Target</a>* <a class="code" href="class_target_table.html#abc558c4a088daf8c5119cca8f9bbc25e" title="A member function that returns a pointer to the target with the given id.">get_targ</a>(TargID <span class="keywordtype">id</span>);
<a name="l00609"></a>00609   <span class="keywordtype">void</span> <a class="code" href="class_target_table.html#a3e5d88d890298a5c90f2aa1800ce5f8b" title="A member function that readies all Target objects in the table for the next round of batch EM...">round_reset</a>();
<a name="l00614"></a><a class="code" href="class_target_table.html#a48dbdbe958ca0102a1c51c5b7085214f">00614</a>   <span class="keywordtype">size_t</span> <a class="code" href="class_target_table.html#a48dbdbe958ca0102a1c51c5b7085214f" title="An accessor for the number of targets in the table.">size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _targ_map.size(); }
<a name="l00619"></a>00619   <span class="keywordtype">double</span> <a class="code" href="class_target_table.html#afcf206ed3491d7866ca7357648410767" title="An accessor for the (logged) total mass per base, including pseudo-counts.">total_fpb</a>() <span class="keyword">const</span>;
<a name="l00625"></a>00625   <span class="keywordtype">void</span> <a class="code" href="class_target_table.html#aef27c7f901b22aed270c6581f7412007" title="a member function that increments the (logged) total mass per base.">update_total_fpb</a>(<span class="keywordtype">double</span> incr_amt);
<a name="l00635"></a><a class="code" href="class_target_table.html#a01fabc67a4faa07a7a8967052b6f0adc">00635</a>   <span class="keywordtype">void</span> <a class="code" href="class_target_table.html#a01fabc67a4faa07a7a8967052b6f0adc" title="A member function that increases the (logged) covariance between two targets by the specified amount...">update_covar</a>(TargID targ1, TargID targ2, <span class="keywordtype">double</span> covar) {
<a name="l00636"></a>00636     _covar_table.<a class="code" href="class_covar_table.html#af6aa14d9c23198551f4a23af9affcdc3" title="A member function that increases the covariance between two targets by the specified amount (logged)...">increment</a>(targ1, targ2, covar);
<a name="l00637"></a>00637   }
<a name="l00645"></a><a class="code" href="class_target_table.html#a572fe629db6eb9bf5f0154d9fba3c4c3">00645</a>   <span class="keywordtype">double</span> <a class="code" href="class_target_table.html#a572fe629db6eb9bf5f0154d9fba3c4c3" title="An accessor for the covariance between two targets.">get_covar</a>(TargID targ1, TargID targ2) {
<a name="l00646"></a>00646     <span class="keywordflow">return</span> _covar_table.<a class="code" href="class_covar_table.html#a66228edb13fbed9e306cb098fcdd3806" title="A member function that returns the covariance between two targets.">get</a>(targ1, targ2);
<a name="l00647"></a>00647   }
<a name="l00652"></a><a class="code" href="class_target_table.html#a04e8efc068a0b55709645cd9ebef35ea">00652</a>   <span class="keywordtype">size_t</span> <a class="code" href="class_target_table.html#a04e8efc068a0b55709645cd9ebef35ea" title="An accessor for number of pairs of targets with non-zero covariance.">covar_size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _covar_table.<a class="code" href="class_covar_table.html#a5427431bae0f4a1130592854774d3775" title="A member function that returns the number of pairs of targets with non-zero covariance.">size</a>(); }
<a name="l00659"></a>00659   <a class="code" href="class_bundle.html" title="The Bundle class keeps track of a group of targets that have shared ambiguous (multi-mapped) reads...">Bundle</a>* <a class="code" href="class_target_table.html#a2e51f8e1e75221158649fa0761153a55" title="A member function that merges the given Bundles.">merge_bundles</a>(<a class="code" href="class_bundle.html" title="The Bundle class keeps track of a group of targets that have shared ambiguous (multi-mapped) reads...">Bundle</a>* b1, <a class="code" href="class_bundle.html" title="The Bundle class keeps track of a group of targets that have shared ambiguous (multi-mapped) reads...">Bundle</a>* b2);
<a name="l00664"></a><a class="code" href="class_target_table.html#a9c37cc61990283d25af5bac1ab7d50c2">00664</a>   <span class="keywordtype">size_t</span> <a class="code" href="class_target_table.html#a9c37cc61990283d25af5bac1ab7d50c2" title="An accessor for the number of bundles in the partition.">num_bundles</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _bundle_table.<a class="code" href="class_bundle_table.html#a5904128a7b085bd209539974f46f829b" title="An accessor for the current number of Bundles.">size</a>(); }
<a name="l00668"></a>00668   <span class="keywordtype">void</span> <a class="code" href="class_target_table.html#ad09b7375b1d5f4258179ca2ab8157787" title="Renormalized masses to be counts and projects when necessary.">masses_to_counts</a>();
<a name="l00681"></a>00681   <span class="keywordtype">void</span> <a class="code" href="class_target_table.html#a79250ef73aa0e1045ebddde2fcf90b9a" title="A member function that outputs the final expression data in a file called &amp;#39;results.xprs&amp;#39;, (optionally) the variance-covariance matrix in &amp;#39;varcov.xprs&amp;#39;, and (optionally) the RDD p-values in the given output directory.">output_results</a>(std::string output_dir, <span class="keywordtype">size_t</span> tot_counts,
<a name="l00682"></a>00682                       <span class="keywordtype">bool</span> output_varcov=<span class="keyword">false</span>, <span class="keywordtype">bool</span> output_rdds=<span class="keyword">false</span>);
<a name="l00689"></a>00689   <span class="keywordtype">void</span> <a class="code" href="class_target_table.html#acf1512804be767661f565eb9140350f9" title="A member function to be run asynchronously that continuously updates the background bias values...">asynch_bias_update</a>(boost::mutex* mutex);
<a name="l00690"></a>00690   <span class="keywordtype">void</span> enable_bundle_threadsafety() { _bundle_table.<a class="code" href="class_bundle_table.html#a6c269feb387dcd1d1abf1e36ca2f7123" title="Accessor for whether or not the BundleTable is in threadsafe mode.">threadsafe_mode</a>(<span class="keyword">true</span>); }
<a name="l00691"></a>00691   <span class="keywordtype">void</span> disable_bundle_threadsafety() { _bundle_table.<a class="code" href="class_bundle_table.html#a6c269feb387dcd1d1abf1e36ca2f7123" title="Accessor for whether or not the BundleTable is in threadsafe mode.">threadsafe_mode</a>(<span class="keyword">false</span>); }
<a name="l00695"></a><a class="code" href="class_target_table.html#ab6fc212148c10929772aa83e818f73d0">00695</a>   <span class="keywordtype">void</span> <a class="code" href="class_target_table.html#ab6fc212148c10929772aa83e818f73d0" title="Collapses the merge trees in the BundleTable.">collapse_bundles</a>() { _bundle_table.<a class="code" href="class_bundle_table.html#a90f33bc5f3b9b2f0785138da81cb5639" title="Collapses the merge tree so that all targets are placed in the target list of the root node and all o...">collapse</a>(); }
<a name="l00696"></a>00696 };
<a name="l00697"></a>00697 
<a name="l00698"></a>00698 <span class="preprocessor">#endif</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><b>targets.h</b>      </li>
      <li class="footer">Generated on Sun Dec 8 2013 11:09:13 for eXpress by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
